function game_loop(){window.requestAnimationFrame(game_loop),cosmo.loop&&cosmo.loop(),cosmo.scene&&(cosmo.scene.update(),cosmo.scene.render()),cosmo.screen.update(),cosmo.screen.render()}var cosmo={game:null,start:null,loop:null,scene:null,time:{fps:60,delta:0,last:0},key:[],touch:[],KEY:{ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},QQVGA:[160,120],HQVGA:[240,160],QVGA:[320,240],WQVGA:[400,240],HVGA:[480,320],nHD:[640,360],VGA:[640,480],WVGA:[800,480],FWVGA:[854,480],qHD:[960,540],DVGA:[960,640],SVGA:[800,600],WSVGA:[1024,600],XGA:[1024,768],WXGA:[1280,720],HD:[1280,720],SXGA:[1280,1024],SXGA_P:[1400,1050],WXGA_P:[1440,900],UXGA:[1600,1200],UXGA_PP:[1680,1050],WUXGA:[1920,1200],FHD:[1920,1080],FULL_HD:[1920,1080],QWXGA:[2048,1152],QXGA:[2048,1536],WQHD:[2560,1440],WQXGA:[2560,1600],LANDSCAPE:!0,PORTRAIT:!1};cosmo.resources=function(t){return document.getElementById(t)},cosmo.res=cosmo.resources,cosmo.keysPressed=function(t){cosmo.key[t.keyCode]=!0},cosmo.keysReleased=function(t){cosmo.key[t.keyCode]=!1},window.addEventListener("keydown",cosmo.keysPressed,!1),window.addEventListener("keyup",cosmo.keysReleased,!1),cosmo.touchAction=function(t){for(var i=0;i<t.changedTouches.length;i++)cosmo.touch[i]={x:Math.round(t.changedTouches[i].clientX*(cosmo.screen.size.width/cosmo.screen.size.content_width)),y:Math.round(t.changedTouches[i].clientY*(cosmo.screen.size.height/cosmo.screen.size.content_height)),radius:{x:t.changedTouches[i].radiusX,y:t.changedTouches[i].radiusY},force:t.changedTouches[i].force,rotation_angle:t.changedTouches[i].rotationAngle}},document.addEventListener("touchstart",cosmo.touchAction),document.addEventListener("touchmove",cosmo.touchAction),document.addEventListener("touchend",function(t){cosmo.touchAction(t),cosmo.touch=[]}),cosmo.Screen=function(t){t=t||{},this.main_canvas=document.createElement("canvas"),this.buffer_canvas=document.createElement("canvas"),t.resolution=t.resolution||cosmo.QVGA;var i=cosmo.res(t.content)||document.body;this.size={},this.size.device_width=document.documentElement.clientWidth,this.size.device_height=document.documentElement.clientHeight,this.size.content_width=void 0===t.content?this.size.device_width:i.offsetWidth,this.size.content_height=void 0===t.content?this.size.device_height:i.offsetHeight;var e=this.size.content_width>=this.size.content_height;this.size.width=e?t.resolution[0]:t.resolution[1],this.size.height=void 0===t.auto_height||t.auto_height===!1?e?t.resolution[1]:t.resolution[0]:this.size.width*(this.size.content_height/this.size.content_width),this.main_canvas.width=this.buffer_canvas.width=this.size.width,this.main_canvas.height=this.buffer_canvas.height=this.size.height,this.main_context=this.main_canvas.getContext("2d"),this.buffer_context=this.buffer_canvas.getContext("2d"),i.appendChild(this.main_canvas)},cosmo.Screen.prototype.draw_image=function(t){t=t||{},t&&(image=cosmo.res(t.image),this.buffer_context.save(),this.buffer_context.translate(t.x,t.y),this.buffer_context.rotate(Math.PI/180*t.rotation||0),this.buffer_context.globalAlpha=t.opacity||1,this.buffer_context.drawImage(image,0,0,image.width,image.height,-Math.round((t.origin_x||image.width/2)*(t.scale_x||1)),-Math.round((t.origin_y||image.height/2)*(t.scale_y||1)),Math.round(image.width*(t.scale_x||1)),Math.round(image.height*(t.scale_y||1))),this.buffer_context.restore())},cosmo.Screen.prototype.update=function(){},cosmo.Screen.prototype.render=function(){this.main_context.drawImage(this.buffer_canvas,0,0)},cosmo.Sound=function(t){t=t||{},this.audio=cosmo.res(t.audio),this.audio.volume=t.volume||1,this.audio.loop=void 0!==t.loop,this.audio.load(),this.play=this.audio.play,this.pause=this.audio.pause},cosmo.Sound.prototype.replay=function(){this.audio.currentTime=0,this.play()},cosmo.Sound.prototype.set_volume=function(t){this.audio.volume=t,this.audio.load()},cosmo.Tiles=function(t){t=t||{},image=cosmo.res(t.image),this.size={row:t.row||1,columns:t.columns||1,width:Math.round(image.width/t.columns)||image.width,height:Math.round(image.height/t.row)||image.height};var i=document.createElement("canvas");i.width=0,i.height=0;for(var e in t.matrix)t.matrix[e][1]>=i.width&&(i.width=t.matrix[e][1]+this.size.width),t.matrix[e][2]>=i.height&&(i.height=t.matrix[e][2]+this.size.height);var s=buffer_.getContext("2d");for(var e in t.matrix)s.drawImage(image,t.matrix[e][0]%this.size.columns*this.size.width,Math.floor(t.matrix[e][0]/this.size.columns)*this.size.height,this.size.width,this.size.height,t.matrix[e][1],t.matrix[e][2],this.size.width,this.size.height);this.full_tiles=i},cosmo.Tiles.prototype.render=function(t){cosmo.screen.buffer_context.drawImage(this.full_tiles,t.x,t.y)},cosmo.Sprite=function(t){t=t||{},this.image=cosmo.res(t.image),this.animation={frames:t.animation_frames||1,speed:t.animation_speed||1,current_frame:0,fix:t.animation_fix||!1,action:t.animation_action||null},this.scale={x:t.scale_x||1,y:t.scale_y||1},this.rotation=t.rotation||0,this.opacity=t.opacity||1,this.visible=void 0===t.visible||t.visible,this.size={width:this.image.width/this.animation.frames,height:this.image.height},this.origin={x:t.origin_x||Math.round(this.size.width/2),y:t.origin_y||Math.round(this.size.height/2)},this.collision={rect:{},half:null,center:{x:0,y:0}},this.collision.rect.x=t.collision_x||0,this.collision.rect.y=t.collision_y||0,this.collision.rect.width=t.collision_width||this.size.width,this.collision.rect.height=t.collision_height||this.size.height,this.collision.half={width:this.collision.rect.width/2,height:this.collision.rect.height/2}},cosmo.Sprite.prototype.update=function(t,i){this.collision.center.x=t+cosmo.scene.x+this.collision.rect.x+this.collision.half.width-this.origin.x,this.collision.center.y=i+cosmo.scene.y+this.collision.rect.y+this.collision.half.height-this.origin.y},cosmo.Sprite.prototype.render=function(t,i){var e=0,s=0;1===this.animation.frames?e=0:this.animation.fix!==!1?e=this.animation.fix:(s=this.animation.current_frame+this.animation.speed*(this.animation.frames/cosmo.time.fps),s>=this.animation.frames?(this.animation.current_frame=0,this.animation.endAction&&this.animation.endAction()):this.animation.current_frame=s,e=Math.floor(this.animation.current_frame)),cosmo.screen.buffer_context.save(),cosmo.screen.buffer_context.translate(t+cosmo.scene.x,i+cosmo.scene.y),cosmo.screen.buffer_context.rotate(Math.PI/180*this.rotation),cosmo.screen.buffer_context.globalAlpha=this.opacity,cosmo.screen.buffer_context.drawImage(this.image,e*this.size.width,0,this.size.width,this.size.height,-this.origin.x,-this.origin.y,this.size.width*this.scale.x,this.size.height*this.scale.y),cosmo.screen.buffer_context.restore()},cosmo.Actor=function(t){t=t||{},this.name=t.name||"Actor",this.x=t.x||0,this.y=t.y||0,this.sprite=t.sprite||null,this.unique=void 0!==t.unique&&t.unique,this.persistent=void 0!==t.persistent&&t.persistent,this.solid=void 0!==t.solid&&t.solid,this.start=t.start||null,this.loop=t.loop||null,this.over=t.over||null,this.block={left:!1,up:!1,right:!1,down:!1}},cosmo.Actor.prototype.on_screen=function(){if(this.sprite){var t=this.x-this.sprite.origin.x+cosmo.scene.x,i=this.x+this.sprite.size.width-this.sprite.origin.x+cosmo.scene.x,e=this.y-this.sprite.origin.y+cosmo.scene.y,s=this.y+this.sprite.size.height-this.sprite.origin.y+cosmo.scene.y;if(i<0||t>cosmo.screen.size.width||s<0||e>cosmo.screen.size.height)return!1}else if(this.x<0||this.x>cosmo.screen.size.width||this.y<0||this.y>cosmo.screen.size.height)return!1;return!0},cosmo.Actor.prototype.colliding=function(t){if(!t){for(var i in cosmo.scene.actor)if(this!==cosmo.scene.actor[i]&&this.colliding(cosmo.scene.actor[i]))return cosmo.scene.actor[i];return!1}if("object"==typeof t){var e=Math.abs(this.sprite.collision.center.x-t.sprite.collision.center.x),s=Math.abs(this.sprite.collision.center.y-t.sprite.collision.center.y),o=this.sprite.collision.half.width+t.sprite.collision.half.width,h=this.sprite.collision.half.height+t.sprite.collision.half.height;return e<o&&s<h}if("string"==typeof t){var c=this.colliding();if(c)return c.name==t}},cosmo.Actor.prototype.push=function(t){if(t){var i=Math.abs(this.sprite.collision.center.x-t.sprite.collision.center.x),e=Math.abs(this.sprite.collision.center.y-t.sprite.collision.center.y),s=this.sprite.collision.half.width+t.sprite.collision.half.width,o=this.sprite.collision.half.height+t.sprite.collision.half.height;if(i<s&&e<o){var h={x:s-i,y:o-e};h.x>h.y?t.sprite.collision.center.y<=this.sprite.collision.center.y?t.y-=h.y:t.y+=h.y:t.sprite.collision.center.x<=this.sprite.collision.center.x?t.x-=h.x:t.x+=h.x}}else for(var c in cosmo.scene.actor)this!==cosmo.scene.actor[c]&&this.push(cosmo.scene.actor[c])},cosmo.Actor.prototype.update=function(){this.loop&&this.loop(this),this.sprite&&this.sprite.visible&&this.sprite.update(this.x,this.y)},cosmo.Actor.prototype.render=function(){this.sprite&&this.sprite.visible&&this.sprite.render(this.x,this.y)},cosmo.BlockRect=function(t){t=t||{},this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.half={width:this.width/2,height:this.height/2},this.center={x:this.x+this.half.width,y:this.y+this.half.height},this.actor=t.actor||null},cosmo.BlockRect.prototype.block=function(t){if(t.solid&&null!==t.sprite){var i=Math.abs(this.center.x-t.sprite.collision.center.x),e=Math.abs(this.center.y-t.sprite.collision.center.y),s=this.half.width+t.sprite.collision.half.width,o=this.half.height+t.sprite.collision.half.height;if(i<s&&e<o){var h={x:s-i,y:o-e};h.x>h.y?t.sprite.collision.center.y<=this.center.y&&!t.block.up?(t.block.up=!0,t.y-=h.y):t.sprite.collision.center.y>this.center.y&&!t.block.down&&(t.block.down=!0,t.y+=h.y):t.sprite.collision.center.x<=this.center.x&&!t.block.left?(t.block.left=!0,t.x-=h.x):t.sprite.collision.center.x>this.center.x&&!t.block.right&&(t.block.right=!0,t.x+=h.x)}}},cosmo.BlockRect.prototype.update=function(){if(this.center={x:this.x+cosmo.scene.x+this.half.width,y:this.y+cosmo.scene.y+this.half.height},null===this.actor)for(var t in cosmo.scene.actor)this.block(cosmo.scene.actor[t]);else if(Array.isArray(this.actor))for(var t in this.actor)this.block(this.actor[t]);else this.block(this.actor)},cosmo.Button=function(t){t=t||{},this.image=cosmo.res(t.image),this.x=t.x||0,this.y=t.y||0,this.press=t.press||null,this.hold=t.hold||null,this.scale={},this.scale.x=t.scale_x||1,this.scale.y=t.scale_y||1,this.key=t.key||null,this.size={},this.size.width=Math.round(this.image.width/2),this.size.height=this.image.height,this.active=!1},cosmo.Button.prototype.pressed=function(){for(var t in cosmo.touch)if(this.x-this.size.width/2<cosmo.touch[t].x&&this.y-this.size.height/2<cosmo.touch[t].y&&this.x+this.size.width/2>cosmo.touch[t].x&&this.y+this.size.height/2>cosmo.touch[t].y)return!0;return!1},cosmo.Button.prototype.update=function(){if(cosmo.key[this.key]||this.pressed()){this.active=!0;try{this.hold()}catch(t){}}else if(this.active){this.active=!1;try{this.press()}catch(t){}}},cosmo.Button.prototype.render=function(){cosmo.screen.buffer_context.drawImage(this.image,this.active?this.size.width:0,0,this.size.width,this.size.height,Math.round(this.x-this.size.width/2),Math.round(this.y-this.size.height/2),this.size.width*this.scale.x,this.size.height*this.scale.y)},cosmo.Analog=function(t){t=t||{}},cosmo.Analog.prototype.update=function(){},cosmo.Analog.prototype.render=function(){},cosmo.Scene=function(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.size={},this.size.width=t.width||cosmo.screen.size.width,this.size.height=t.height||cosmo.screen.height,this.actor=t.actor||[],this.tiles=t.tiles||[[],[]],this.button=t.button||[],this.analog=t.analog||[],this.block_rect=t.block_rect||[],this.background_color=t.background_color||"rgb(0,162,232)",this.background_image=t.background_image||[],this.background_music=t.background_music||null},cosmo.Scene.prototype.loop=null,cosmo.Scene.prototype.add=function(t,i){switch(i=i||{},Object.getPrototypeOf(t)){case cosmo.Actor.prototype:t.unique?this.actor.push(t):this.actor.push(Object.assign(new cosmo.Actor,t));var e=this.actor[this.actor.length-1];e.start&&e.start(e),e.x=i[0]||i.x||e.x,e.y=i[1]||i.y||e.y;break;case cosmo.Tiles.prototype:this.tiles[i||i.layer||0].push(t);break;case cosmo.Button.prototype:this.button.push(t),t.x=i[0]||i.x||t.x,t.y=i[1]||i.y||t.y;break;case cosmo.Analog.prototype:this.analog.push(t),t.x=i[0]||i.x||t.x,t.y=i[1]||i.y||t.y;break;case cosmo.BlockRect.prototype:this.block_rect.push(t);break;case String.prototype:image=cosmo.res(t),this.background_image.push(t)}},cosmo.Scene.prototype.update=function(){this.actor.sort(function(t,i){return t.y-i.y});for(var t in this.actor)(this.actor[t].on_screen()||this.actor[t].persistent)&&this.actor[t].update();for(var t in this.button)this.button[t].update();for(var t in this.block_rect)this.block_rect[t].update();this.loop&&this.loop(this)},cosmo.Scene.prototype.render=function(){cosmo.screen.buffer_context.save(),cosmo.screen.buffer_context.fillStyle=this.background_color,cosmo.screen.buffer_context.fillRect(0,0,cosmo.screen.size.width,cosmo.screen.size.height);for(var t in this.background_image)cosmo.screen.buffer_context.drawImage(this.background_image[t],this.x,this.y);for(var t in this.tiles[0])this.tiles[0][t].render(this);for(var t in this.actor)this.actor[t].on_screen()&&this.actor[t].render();for(var t in this.tiles[1])this.tiles[1][t].render(this);for(var t in this.button)this.button[t].render()},cosmo.play=function(){this.game&&(this.game(this),this.start&&this.start(this),this.screen&&game_loop())};