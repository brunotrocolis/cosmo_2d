var cosmo;(function(t){function e(){t.time.fps=Math.round(1e3/(performance.now()-t.time.last)),t.time.last=performance.now()}function i(s){window.requestAnimationFrame(i),t.game.update(),t.game.render(),e()}function s(e){t.game=e,i(performance.now())}t.QQVGA=[160,120],t.HQVGA=[240,160],t.QVGA=[320,240],t.WQVGA=[400,240],t.HVGA=[480,320],t.nHD=[640,360],t.VGA=[640,480],t.WVGA=[800,480],t.FWVGA=[854,480],t.qHD=[960,540],t.DVGA=[960,640],t.SVGA=[800,600],t.WSVGA=[1024,600],t.XGA=[1024,768],t.WXGA=[1280,720],t.HD=[1280,720],t.SXGA=[1280,1024],t.SXGA_P=[1400,1050],t.WXGA_P=[1440,900],t.UXGA=[1600,1200],t.UXGA_PP=[1680,1050],t.WUXGA=[1920,1200],t.FHD=[1920,1080],t.FULL_HD=[1920,1080],t.QWXGA=[2048,1152],t.QXGA=[2048,1536],t.WQHD=[2560,1440],t.WQXGA=[2560,1600],t.LANDSCAPE=!1,t.PORTRAIT=!0,t.test={active:!1,update:function(){},render:function(){t.game.screen.buffer_context.fillStyle="#000000",t.game.screen.buffer_context.fillText("FPS: "+t.time.fps,10,10),t.game.screen.buffer_context.strokeStyle="#FFFF00",t.game.screen.buffer_context.strokeRect(t.game.screen.camera.left,t.game.screen.camera.top,t.game.screen.size.width-(t.game.screen.camera.left+t.game.screen.camera.right),t.game.screen.size.height-(t.game.screen.camera.top+t.game.screen.camera.bottom)),t.game.scene.actor.forEach(function(e){var i=e.sprite,s=t.game.screen.buffer_context;if(void 0!==i){var n=e.x+t.game.scene.x,o=e.y+t.game.scene.y;s.beginPath(),s.moveTo(n-3,o),s.lineTo(n+3,o),s.moveTo(n,o-3),s.lineTo(n,o+3),s.strokeStyle="#FF0000",s.stroke(),s.closePath(),s.strokeStyle="#0000FF",s.strokeRect(n-i.origin.x,o-i.origin.y,i.size.width,i.size.height),e.collision()?s.strokeStyle="#FF0000":s.strokeStyle="#00FF00",s.strokeRect(n-i.origin.x+i.collision.rect.x,o-i.origin.y+i.collision.rect.y,i.collision.rect.width,i.collision.rect.height)}}),t.game.screen.buffer_context.strokeStyle="#FF0000",t.game.screen.buffer_context.fillStyle="rgba(255,0,0,0.3)",t.game.scene.tiles[0].forEach(function(e){e.blockMap&&e.blockMap.forEach(function(e){t.game.screen.buffer_context.strokeRect(e.x+t.game.scene.x,e.y+t.game.scene.y,e.size.width,e.size.height),t.game.screen.buffer_context.fillRect(e.x+t.game.scene.x,e.y+t.game.scene.y,e.size.width,e.size.height)})}),t.game.scene.tiles[1].forEach(function(e){e.blockMap&&e.blockMap.forEach(function(e){t.game.screen.buffer_context.strokeRect(e.x+t.game.scene.x,e.y+t.game.scene.y,e.size.width,e.size.height),t.game.screen.buffer_context.fillRect(e.x+t.game.scene.x,e.y+t.game.scene.y,e.size.width,e.size.height)})})}},t.time={fps:60,last:0},t.key=[],t.fps=e,t.loop=i,t.play=s,window.addEventListener("keydown",function(e){t.key[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){t.key[e.keyCode]=!1},!1);var n=function(){function e(t){void 0===t&&(t={}),this.name=t.name||"Actor",this.x=t.x||0,this.y=t.y||0,this.sprite=t.sprite||void 0,this.unique=void 0!==t.unique&&t.unique,this.persistent=void 0!==t.persistent&&t.persistent,this.solid=void 0===t.solid||t.solid,this.block={left:!1,up:!1,right:!1,down:!1},this.start=t.start||function(){},this.loop=t.loop||function(){},this.over=t.over||function(){}}return e.prototype.start=function(){},e.prototype.loop=function(){},e.prototype.over=function(){},e.prototype.on_screen=function(){if(t.game.scene.actor.indexOf(this)>-1&&void 0!==this.sprite){var e=this.x-this.sprite.origin.x+t.game.scene.x,i=this.x+this.sprite.size.width-this.sprite.origin.x+t.game.scene.x,s=this.y-this.sprite.origin.y+t.game.scene.y,n=this.y+this.sprite.size.height-this.sprite.origin.y+t.game.scene.y;return!(i<0||e>t.game.screen.size.width||n<0||s>t.game.screen.size.height)}return!1},e.prototype.collision=function(e){var i=this;if(void 0===this.sprite)return!1;switch(typeof e){case"string":var s=this.collision();return!!s&&s.name===e;case"object":if(void 0!==e.sprite){var n=Math.abs(this.sprite.collision.center.x-e.sprite.collision.center.x),o=Math.abs(this.sprite.collision.center.y-e.sprite.collision.center.y),r=this.sprite.collision.half.width+e.sprite.collision.half.width,h=this.sprite.collision.half.height+e.sprite.collision.half.height;return n<r&&o<h}return!1;case"undefined":return t.game.scene.actor.forEach(function(t){if(i!==t&&i.collision(t))return t}),!1}},e.prototype.push=function(e){var i=this;if(void 0!==this.sprite)if(void 0===e)t.game.scene.actor.forEach(function(t){i.push(t)});else if(void 0!==e.sprite){var s=Math.abs(this.sprite.collision.center.x-e.sprite.collision.center.x),n=Math.abs(this.sprite.collision.center.y-e.sprite.collision.center.y),o=this.sprite.collision.half.width+e.sprite.collision.half.width,r=this.sprite.collision.half.height+e.sprite.collision.half.height;if(s<o&&n<r){var h={x:o-s,y:r-n};h.x>h.y?e.sprite.collision.center.y<=this.sprite.collision.center.y?e.y-=h.y:e.y+=h.y:e.sprite.collision.center.x<=this.sprite.collision.center.x?e.x-=h.x:e.x+=h.x}}},e.prototype.update=function(){this.loop(),this.sprite.update(this.x,this.y)},e.prototype.render=function(){this.sprite.render(this.x,this.y)},e}();t.Actor=n;var o=function(){function t(){}return t}();t.Analog=o;var r=function(){function e(t){void 0===t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.size={width:t.width,height:t.height},this.half={width:this.size.width/2,height:this.size.height/2}}return e.prototype.update=function(){var e=this;this.center={x:this.x+t.game.scene.x+this.half.width,y:this.y+t.game.scene.y+this.half.height},t.game.scene.actor.forEach(function(t){e.block(t)})},e.prototype.block=function(t){if(void 0!==t.sprite&&t.solid){var e=Math.abs(this.center.x-t.sprite.collision.center.x),i=Math.abs(this.center.y-t.sprite.collision.center.y),s=this.half.width+t.sprite.collision.half.width,n=this.half.height+t.sprite.collision.half.height;if(e<s&&i<n){var o={x:s-e,y:n-i};o.x>o.y?t.sprite.collision.center.y<=this.center.y&&!t.block.up?(t.block.up=!0,t.y-=o.y):t.sprite.collision.center.y>this.center.y&&!t.block.down&&(t.block.down=!0,t.y+=o.y):t.sprite.collision.center.x<=this.center.x&&!t.block.left?(t.block.left=!0,t.x-=o.x):t.sprite.collision.center.x>this.center.x&&!t.block.right&&(t.block.right=!0,t.x+=o.x)}}t.block={left:!1,up:!1,right:!1,down:!1}},e}();t.Block=r;var h=function(){function t(){}return t}();t.Button=h;var a=function(){function e(e){t.game=this;var e=e||{};this.screen=e.screen||new t.Screen,this.scene=e.scene||new t.Scene}return e.prototype.loop=function(){},e.prototype.play=function(){t.play(this)},e.prototype.update=function(){this.loop(),this.scene.update(),t.test.active&&t.test.update(),this.screen.update()},e.prototype.render=function(){this.scene.render(),t.test.active&&t.test.render(),this.screen.render()},e}();t.Game=a;var c=function(){function e(e){void 0===e&&(e={});var i=this;this.name=e.name||"Map",this.x=e.x||0,this.y=e.y||0,this.size={width:e.width||t.game.screen.size.width,height:e.height||t.game.screen.size.height},this.actor=[],void 0!==e.actor&&e.actor.forEach(function(t){i.add(t)}),this.tiles=e.tiles||[[],[]],this.background={color:e.background_color||"#FFFFFF",image:e.background_image||[],music:e.background_music||null}}return e.prototype.add=function(e,i){switch(void 0===i&&(i={}),Object.getPrototypeOf(e)){case t.Actor.prototype:e.unique?this.actor.push(e):this.actor.push(Object.assign(new t.Actor,e));var s=this.actor[this.actor.length-1];s.start(),s.x=i[0]||i.x||s.x,s.y=i[1]||i.y||s.y;break;case t.Tiles.prototype:this.tiles[i.layer||0].push(e)}},e.prototype.update=function(){this.actor.forEach(function(t){t.update()}),this.tiles[0].forEach(function(t){t.update()}),this.tiles[1].forEach(function(t){t.update()})},e.prototype.render=function(){this.tiles[0].forEach(function(t){t.render()}),this.actor.forEach(function(t){t.render()}),this.tiles[1].forEach(function(t){t.render()})},e}();t.Scene=c;var l=function(){function e(e){var e=e||{};this.main_canvas=document.createElement("canvas");var i="display: block;margin: auto;width: 100%;-ms-interpolation-mode: nearest-neighbor;image-rendering: -webkit-optimize-contrast;image-rendering: -webkit-crisp-edges;image-rendering: -moz-crisp-edges;image-rendering: -o-crisp-edges; image-rendering: pixelated;";this.main_canvas.setAttribute("style",i),this.buffer_canvas=document.createElement("canvas");var s=document.getElementById(e.content)||document.body;i="margin: 0;padding: 0;overflow: hidden;",s.setAttribute("style",i),this.size={device:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},content:{width:void 0===e.content?document.documentElement.clientWidth:s.offsetWidth,height:void 0===e.content?document.documentElement.clientHeight:s.offsetHeight}};var n=e.resolution||t.QVGA,o=e.orientation||document.documentElement.clientWidth>=document.documentElement.clientHeight;this.size.width=o?n[0]:n[1],this.size.height=void 0===e.auto_height||e.auto_height===!1?o?n[1]:n[0]:this.size.width*(this.size.content.height/this.size.content.width),this.main_canvas.width=this.buffer_canvas.width=this.size.width,this.main_canvas.height=this.buffer_canvas.height=this.size.height,this.main_context=this.main_canvas.getContext("2d"),this.buffer_context=this.buffer_canvas.getContext("2d"),s.appendChild(this.main_canvas);var r=Math.round(.1*this.size.height),h=Math.round(.1*this.size.width);this.camera={top:e.camera_top||r,bottom:e.camera_bottom||r,left:e.camera_left||h,right:e.camera_right||h,actor:e.camera_actor||void 0}}return e.prototype.update=function(){void 0!==this.camera.actor&&(this.camera.actor.x<this.camera.left-t.game.scene.x&&t.game.scene.x<0?t.game.scene.x=-(this.camera.actor.x-this.camera.left):this.camera.actor.x>this.size.width-this.camera.right-t.game.scene.x&&t.game.scene.x>-(t.game.scene.size.width-this.size.width)&&(t.game.scene.x=-(this.camera.actor.x-(this.size.width-this.camera.right))),this.camera.actor.y<this.camera.top-t.game.scene.y&&t.game.scene.y<0?t.game.scene.y=-(this.camera.actor.y-this.camera.top):this.camera.actor.y>this.size.height-this.camera.bottom-t.game.scene.y&&t.game.scene.y>-(t.game.scene.size.height-this.size.height)&&(t.game.scene.y=-(this.camera.actor.y-(this.size.height-this.camera.bottom))))},e.prototype.render=function(){this.main_context.clearRect(0,0,this.size.width,this.size.height),this.main_context.drawImage(this.buffer_canvas,0,0),this.buffer_context.clearRect(0,0,this.size.width,this.size.height)},e}();t.Screen=l;var m=function(){function t(t){var t=t||{};this.audio=t.audio||new HTMLAudioElement,this.audio.volume=t.volume||1,this.audio.loop=void 0!==t.loop&&t.loop,this.play=this.audio.play,this.pause=this.audio.pause}return t.prototype.play=function(){},t.prototype.pause=function(){},t.prototype.replay=function(){this.audio.currentTime=0,this.play()},t.prototype.set_volume=function(t){this.audio.volume=t,this.audio.load()},t}();t.Sound=m;var u=function(){function e(t){void 0===t&&(t={});var e=this;this.image=new Image,this.image.src=t.image||null,this.animation={frames:t.animation_frames||1,speed:t.animation_speed||1,current_frame:0,fix:t.animation_fix||!1,over_action:t.over_action||function(){}},this.scale={x:t.scale_x||1,y:t.scale_y||1},this.rotation=t.rotation||0,this.opacity=t.opacity||1,this.size={width:0,height:0},this.origin={x:0,y:0},this.collision={rect:{x:t.collision_x||0,y:t.collision_y||0,width:0,height:0},half:{width:0,height:0},center:{x:0,y:0}},this.image.onload=function(){e.size={width:e.image.width/e.animation.frames,height:e.image.height},e.origin={x:t.origin_x||Math.round(e.size.width/2),y:t.origin_y||Math.round(e.size.height/2)},e.collision.rect.width=t.collision_width||e.size.width,e.collision.rect.height=t.collision_height||e.size.height,e.collision.half={width:e.collision.rect.width/2,height:e.collision.rect.height/2}}}return e.prototype.update=function(e,i){this.collision.center.x=e+t.game.scene.x+this.collision.rect.x+this.collision.half.width-this.origin.x,this.collision.center.y=i+t.game.scene.y+this.collision.rect.y+this.collision.half.height-this.origin.y},e.prototype.render=function(e,i){var s=0,n=0;1===this.animation.frames?s=0:this.animation.fix!==!1?s=this.animation.fix:(n=this.animation.current_frame+this.animation.speed*(this.animation.frames/t.time.fps),n>=this.animation.frames?(this.animation.current_frame=0,this.animation.endAction&&this.animation.endAction()):this.animation.current_frame=n,s=Math.floor(this.animation.current_frame));var o=t.game.screen.buffer_context;o.save(),o.translate(e+t.game.scene.x,i+t.game.scene.y),o.rotate(Math.PI/180*this.rotation),o.globalAlpha=this.opacity,o.drawImage(this.image,s*this.size.width,0,this.size.width,this.size.height,-this.origin.x,-this.origin.y,this.size.width*this.scale.x,this.size.height*this.scale.y),o.restore()},e}();t.Sprite=u;var d=function(){function e(t){void 0===t&&(t={});var e=this;this.image=new Image,this.image.src=t.image,this.image.onload=function(){e.size={rows:t.rows||1,columns:t.columns||1,width:Math.round(e.image.width/(t.columns||1)),height:Math.round(e.image.height/(t.rows||1))},void 0!==t.matrix&&(e.setTileMap(t.matrix),void 0!==t.block&&(e.tileBlock=t.block,e.blockMap=[],e.setBlockMap(t.matrix)))}}return e.prototype.setTileMap=function(t){this.tileMap=document.createElement("canvas"),this.tileMap.width=0,this.tileMap.height=0;for(var e in t)t[e][2]>=this.tileMap.width&&(this.tileMap.width=t[e][2]+this.size.width),t[e][3]>=this.tileMap.height&&(this.tileMap.height=t[e][3]+this.size.height);var i=this.tileMap.getContext("2d");for(var e in t)i.drawImage(this.image,t[e][0]*this.size.width,t[e][1]*this.size.height,this.size.width,this.size.height,t[e][2],t[e][3],this.size.width,this.size.height)},e.prototype.setBlockMap=function(e){var i=this,s=[];e.forEach(function(t){i.tileBlock[(t[0],t[1])]&&s.push({x:t[2],y:t[3]})}),s.sort(function(t,e){return t.x-e.x}),s.sort(function(t,e){return t.y-e.y});var n=[],o={};s.forEach(function(t){void 0===o.x1?o={x1:t.x,y1:t.y,x2:t.x+i.size.width,y2:t.y+i.size.height}:o.x2===t.x&&o.y1===t.y?o.x2=t.x+i.size.width:(n.push(o),o={x1:t.x,y1:t.y,x2:t.x+i.size.width,y2:t.y+i.size.height})}),n.push(o),n.sort(function(t,e){return t.x2-e.x2}),n.sort(function(t,e){return t.x1-e.x1});var r=[];o={},n.forEach(function(t){void 0===o.x1?o=t:t.y1===o.y2&&t.x2===o.x2?o.y2=t.y2:(r.push(o),o=t)}),r.push(o),r.forEach(function(e){i.blockMap.push(new t.Block({x:e.x1,y:e.y1,width:e.x2-e.x1,height:e.y2-e.y1}))})},e.prototype.update=function(){this.blockMap&&this.blockMap.forEach(function(t){t.update()})},e.prototype.render=function(){this.tileMap&&t.game.screen.buffer_context.drawImage(this.tileMap,t.game.scene.x,t.game.scene.y)},e}();t.Tiles=d})(cosmo||(cosmo={}));